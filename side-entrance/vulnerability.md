# Vulnerability Analysis - Side Entrance

## Context
The SideEntranceLenderPool contract combines two functionalities:
1. An ETH deposit/withdrawal system
2. A flash loan service

These two systems interact with the same ETH reserve but use different accounting mechanisms.

## Attack Vector
The vulnerability stems from the inconsistency between two accounting systems:

1. **Real balance**: `address(this).balance`
   - The actual ETH in the contract

2. **Accounting balance**: `balances[address]`
   - The registry of each user's deposits

During a flashloan, the contract only checks that its ETH balance has returned to the same level, but doesn't verify how it returned. This inconsistency allows an attacker to:

1. Borrow via flashloan
2. Deposit these same funds via deposit()
3. Satisfy the flashloan verification
4. Later, withdraw the funds via withdraw()

## Technical Details
```solidity
// Deposit system
function deposit() external payable {
    balances[msg.sender] += msg.value;
}

// Withdrawal system
function withdraw() external {
    uint256 amountToWithdraw = balances[msg.sender];
    balances[msg.sender] = 0;
    msg.sender.sendValue(amountToWithdraw);
}

// Flash loan system
function flashLoan(uint256 amount) external {
    uint256 balanceBefore = address(this).balance;
    
    IFlashLoanEtherReceiver(msg.sender).execute{value: amount}();

    require(address(this).balance >= balanceBefore, "Flash loan hasn't been paid back");        
}
```

The problem: the flashloan repayment can be made using `deposit()`, which creates an unintended "side entrance" into the system.

## Attack Flow Diagram
[See diagram](./diagrams/side-entrance-flow.png)