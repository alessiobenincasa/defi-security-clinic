# Vulnerability Analysis

## Context
The UnstoppableLender protocol allows flash loans of tokens, using a mechanism to track internal balance versus the actual balance.

## Attack Vector
The `flashLoan()` function contains a critical assertion:

```solidity
assert(poolBalance == balanceBefore);
```

This assertion requires that the internal balance (`poolBalance`) always equals the actual balance. However, there is a way to modify the actual balance without updating `poolBalance`.

## Technical Details
1. The contract updates `poolBalance` only through the `depositTokens()` function
2. Nothing prevents a user from sending tokens directly to the contract via `transfer()`
3. This inconsistency between the tracked balance and the actual balance breaks the invariant

## Attack Flow Diagram
[See diagram](./diagrams/unstoppable-flow.png)